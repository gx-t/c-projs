<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Manipulating Row Data</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GTK+ 2.0 Tree View Tutorial"
HREF="treeview-tutorial.html"><LINK
REL="UP"
TITLE="GtkTreeModels for Data Storage: GtkListStore and GtkTreeStore"
HREF="sec-treemodels.html"><LINK
REL="PREVIOUS"
TITLE="Adding Rows to a Store"
HREF="sec-treemodel-add-rows.html"><LINK
REL="NEXT"
TITLE="Retrieving Row Data"
HREF="sec-treemodel-data-retrieval.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="./treeview-tutorial.css"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GTK+ 2.0 Tree View Tutorial</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sec-treemodel-add-rows.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 3. GtkTreeModels for Data Storage: GtkListStore and GtkTreeStore</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sec-treemodel-data-retrieval.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="95%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="sec-treemodel-data-manipulation"
>3.4. Manipulating Row Data</A
></H1
><P
>&#13;Adding empty rows to a data store is not terribly exciting, so let's see how we can add or change data in the store.
</P
><P
>&#13;<A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkListStore.html#gtk-list-store-set"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_list_store_set</TT
></A
> and
<A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkTreeStore.html#gtk-tree-store-set"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_tree_store_set</TT
></A
> are used
to manipulate a given row's data. There is also <TT
CLASS="literal"
>gtk_list_store_set_value</TT
>
and <TT
CLASS="literal"
>gtk_tree_store_set_value</TT
>, but those should only be used by people
familiar with GLib's GValue system.
</P
><P
>&#13;Both <TT
CLASS="literal"
>gtk_list_store_set</TT
> and <TT
CLASS="literal"
>gtk_tree_store_set</TT
> take
a variable number of arguments, and must be terminated with a -1 argument. The first two
arguments are a pointer to the model, and the iter pointing to the row whose data we want
to change. They are followed by a variable number of (column, data) argument pairs,
terminated by a -1. The column refers to the model column number and is usually an enum
value (to make the code more readable and to make changes easier). The data should be of
the same data type as the model column.
</P
><P
>&#13;Here is an example where we create a store that stores two strings and one integer for each row:
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  enum
  {
    COL_FIRST_NAME = 0,
    COL_LAST_NAME,
    COL_YEAR_BORN,
    NUM_COLS
  };

  GtkListStore *liststore;
  GtkTreeIter   iter;

  liststore = gtk_list_store_new(NUM_COLS, G_TYPE_STRING, G_TYPE_STRING, G_TYPE_UINT);

  /* Append an empty row to the list store. Iter will point to the new row */
  gtk_list_store_append(liststore, &#38;iter);

  /* Fill fields with some data */
  gtk_list_store_set (liststore, &#38;iter,
                      COL_FIRST_NAME, "Joe",
                      COL_LAST_NAME, "Average",
                      COL_YEAR_BORN, (guint) 1970,
                      -1);
</PRE
></TD
></TR
></TABLE
><P
>&#13;You do not need to worry about allocating and freeing memory for the data to store.
The model (or more precisely: the GLib/GObject GType and GValue system) will take care of that for you.
If you store a string, for example, the model will make a copy of the string and store that. If you then
set the field to a new string later on, the model will automatically free the old string and again make
a copy of the new string and store the copy. This applies to almost all types, be it
<TT
CLASS="literal"
>G_TYPE_STRING</TT
> or <TT
CLASS="literal"
>GDK_TYPE_PIXBUF</TT
>.
</P
><P
>&#13;The exception to note is <TT
CLASS="literal"
>G_TYPE_POINTER</TT
>. If you allocate a chunk of
data or a complex structure and store it in a <TT
CLASS="literal"
>G_TYPE_POINTER</TT
> field,
only the pointer <I
CLASS="emphasis"
>value</I
> is stored. The model does not know anything
about the size or content of the data your pointer refers to, so it could not even make
a copy if it wanted to, so you need to allocate and free the memory yourself in this case.
However, if you do not want to do that yourself and want the model to take care of your
custom data for you, then you need to register your own type and derive it from one of
the GLib fundamental types (usually <A
HREF="http://developer.gnome.org/doc/API/2.0/gobject/gobject-Boxed-Types.html"
TARGET="_top"
>G_TYPE_BOXED</A
>).
See the GObject <A
HREF="http://developer.gnome.org/doc/API/2.0/gobject/gobject-GType.html"
TARGET="_top"
>GType reference manual</A
>
for details. Making a copy of data involves memory allocation and other overhead of course,
so one should consider the performance implications of using a custom GLib type over a
G_TYPE_POINTER carefully before taking that approach. Again, a custom model might be the
better alternative, depending on the overall amount of data to be stored (and retrieved).
</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="95%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sec-treemodel-add-rows.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="treeview-tutorial.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sec-treemodel-data-retrieval.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Adding Rows to a Store</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sec-treemodels.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Retrieving Row Data</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>