<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Editable Cells</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GTK+ 2.0 Tree View Tutorial"
HREF="treeview-tutorial.html"><LINK
REL="PREVIOUS"
TITLE="Case-insensitive String Comparing"
HREF="sec-sorting-string-nocase.html"><LINK
REL="NEXT"
TITLE="Editable Toggle and Radio Button Cells"
HREF="sec-editable-cells-toggle.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="./treeview-tutorial.css"></HEAD
><BODY
CLASS="chapter"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GTK+ 2.0 Tree View Tutorial</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sec-sorting-string-nocase.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sec-editable-cells-toggle.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="95%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="sec-editable-cells"
></A
>Chapter 8. Editable Cells</H1
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="sec-editable-cells-text"
>8.1. Editable Text Cells</A
></H1
><P
>&#13;With <TT
CLASS="literal"
>GtkCellRendererText</TT
> you can not only display
text, but you can also allow the user to edit a single cell's text
right in the tree view by double-clicking on a cell.
</P
><P
>&#13;To make this work you need to tell the cell renderer that a cell is
editable, which you can do by setting the <TT
CLASS="literal"
>"editable"</TT
>
property of the text cell renderer in question to <TT
CLASS="literal"
>TRUE</TT
>.
You can either do this on a per-row basis (which allows you to set each
single cell either editable or not) by connecting the <TT
CLASS="literal"
>"editable"</TT
>
property to a boolean type column in your tree model using attributes; or you
can just do a ...
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  g_object_set(renderer, "editable", TRUE, NULL);
</PRE
></TD
></TR
></TABLE
><P
>&#13;... when you create the renderer, which sets all rows in that particular
renderer column to be editable.
</P
><P
>&#13;Now that our cells are editable, we also want to be notified when a cell has
been edited. This can be achieved by connecting to the cell renderer's
<TT
CLASS="literal"
>"edited"</TT
> signal:
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  g_signal_connect(renderer, "edited", (GCallback) cell_edited_callback, NULL);
</PRE
></TD
></TR
></TABLE
><P
>&#13;This callback is then called whenever a cell has been edited. Instead of
<TT
CLASS="literal"
>NULL</TT
> we could have passed a pointer to the model as
user data for convenience, as we probably want to store the new value in
the model.
</P
><P
>&#13;The callback for the <TT
CLASS="literal"
>"edited"</TT
> signal looks like this
(the API reference is a bit lacking in this particular case):
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;void        cell_edited_callback (GtkCellRendererText *cell,
                                  gchar               *path_string,
                                  gchar               *new_text,
                                  gpointer             user_data);
</PRE
></TD
></TR
></TABLE
><P
>&#13;The tree path is passed to the <TT
CLASS="literal"
>"edited"</TT
> signal callback
in string form. You can convert this into a <TT
CLASS="literal"
>GtkTreePath</TT
> with
<A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkTreeModel.html#gtk-tree-path-new-from-string"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_tree_path_new_from_string</TT
></A
>, or convert it into an
iter with <A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkTreeModel.html#gtk-tree-model-get-iter-from-string"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_tree_model_get_iter_from_string</TT
></A
>.
</P
><P
>&#13;Note that the cell renderer will not change the data for you in the store.
After a cell has been edited, you will only receive an <TT
CLASS="literal"
>"edited"</TT
>
signal. If you do not change the data in the store, the old text will be rendered
again as if nothing had happened.
</P
><P
>&#13;If you have multiple (renderer) columns with editable cells, it is not necessary
to have a different callback for each renderer, you can use the same callback
for all renderers, and attach some data to each renderer, which you can later
retrieve again in the callback to know which renderer/column has been edited.
This is done like this, for example:
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  renderer = gtk_cell_renderer_text_new();
  ...
  g_object_set_data(G_OBJECT(renderer), "my_column_num", GUINT_TO_POINTER(COLUMN_NAME));

  ...

  renderer = gtk_cell_renderer_text_new();
  ...
  g_object_set_data(G_OBJECT(renderer), "my_column_num", GUINT_TO_POINTER(COLUMN_YEAR_OF_BIRTH));

  ...
</PRE
></TD
></TR
></TABLE
><P
>&#13;where COLUMN_NAME and COLUMN_YEAR_OF_BIRTH are enum values. In your callback you can
then get the column number with
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  guint column_number = GPOINTER_TO_UINT(g_object_get_data(G_OBJECT(renderer), "my_column_num"));
</PRE
></TD
></TR
></TABLE
><P
>&#13;You can use this mechanism to attach all kinds of custom data to any
object or widget, with a string identifier to your liking.
</P
><P
>&#13;A good example for editable cells is in gtk-demo, which is part of the Gtk+
source code tree (in gtk+-2.x.y/demos/gtk-demo).
</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="sec-editable-cells-text-set"
>8.1.1. Setting the cursor to a specific cell</A
></H2
><P
>&#13;You can move the cursor to a specific cell in a tree view with
<A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkTreeView.html#gtk-tree-view-set-cursor"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_tree_view_set_cursor</TT
></A
>
(or <A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkTreeView.html#gtk-tree-view-set-cursor-on-cell"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_tree_view_set_cursor_on_cell</TT
></A
> if you have
multiple editable cell renderers packed into one tree view column), and start editing
the cell if you want to. Similarly, you can get the current row and focus column with
<A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkTreeView.html#gtk-tree-view-get-cursor"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_tree_view_get_cursor</TT
></A
>.
Use <A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkWidget.html#gtk-widget-grab-focus"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_widget_grab_focus(treeview)</TT
></A
> will make sure that the tree view
has the keyboard focus.
</P
><P
>&#13;As the API reference points out, the tree view needs to be realised for cell editing to
happen. In other words: If you want to start editing a specific cell right at program
startup, you need to set up an idle timeout with
<A
HREF="http://developer.gnome.org/doc/API/2.0/glib/glib-The-Main-Event-Loop.html#g-idle-add"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>g_idle_add</TT
></A
> that does this for you as soon as the window and
everything else has been realised (return <TT
CLASS="literal"
>FALSE</TT
> in the
timeout to make it run only once). Alternatively you could connect to the
<TT
CLASS="literal"
>"realize"</TT
> signal of the treeview with
<TT
CLASS="literal"
>g_signal_connect_after</TT
> to achieve the same thing.
</P
><P
>&#13;Connect to the tree view's <TT
CLASS="literal"
>"cursor-changed"</TT
> and/or
<TT
CLASS="literal"
>"move-cursor"</TT
> signals to keep track of the current
position of the cursor.
</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="95%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sec-sorting-string-nocase.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="treeview-tutorial.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sec-editable-cells-toggle.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Case-insensitive String Comparing</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Editable Toggle and Radio Button Cells</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>