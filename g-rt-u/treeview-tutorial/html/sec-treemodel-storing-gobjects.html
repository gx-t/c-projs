<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Storing GObjects (Pixbufs etc.)</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GTK+ 2.0 Tree View Tutorial"
HREF="treeview-tutorial.html"><LINK
REL="UP"
TITLE="GtkTreeModels for Data Storage: GtkListStore and GtkTreeStore"
HREF="sec-treemodels.html"><LINK
REL="PREVIOUS"
TITLE="Removing Multiple Rows"
HREF="sec-treemodel-remove-many-rows.html"><LINK
REL="NEXT"
TITLE="Storing Data Structures: of Pointers, GBoxed Types, and GObject (TODO)"
HREF="sec-treemodel-storing-structs.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="./treeview-tutorial.css"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GTK+ 2.0 Tree View Tutorial</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sec-treemodel-remove-many-rows.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 3. GtkTreeModels for Data Storage: GtkListStore and GtkTreeStore</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sec-treemodel-storing-structs.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="95%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="sec-treemodel-storing-gobjects"
>3.8. Storing GObjects (Pixbufs etc.)</A
></H1
><P
>&#13;A special case are <TT
CLASS="literal"
>GObject</TT
> types, like <TT
CLASS="literal"
>GDK_TYPE_PIXBUF</TT
>,
that get stored in a list or tree store. The store will not make a copy of the object, rather
it will increase the object's refcount. The store will then unref the object again if it is
no longer needed (ie. a new object is stored in the old object's place, the current value
is replaced by NULL, the row is removed, or the store is destroyed).
</P
><P
>&#13;From a developer perspective, this means that you need to <TT
CLASS="literal"
>g_object_unref</TT
>
an object that you have just added to the store if you want the store to automatically dispose
of it when no longer needed. This is because on object creation, the object has an initial
refcount of 1, which is "your" refcount, and the object will only be destroyed when it
reaches a refcount of 0. Here is the life cycle of a pixbuf:
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  GtkListStore *list_store;
  GtkTreeIter   iter;
  GdkPixbuf    *pixbuf;
  GError       *error = NULL;

  list_store = gtk_list_store_new (2, GDK_TYPE_PIXBUF, G_TYPE_STRING);

  pixbuf = gdk_pixbuf_new_from_file("icon.png", &#38;error);

  /* pixbuf has a refcount of 1 after creation */

  if (error)
  {
    g_critical ("Could not load pixbuf: %s\n", error-&#62;message);
    g_error_free(error);
    return;
  }

  gtk_list_store_append(list_store, &#38;iter);

  gtk_list_store_set(list_store, &#38;iter, 0, pixbuf, 1, "foo", -1);

  /* pixbuf has a refcount of 2 now, as the list store has added its own reference */

  g_object_unref(pixbuf);

  /* pixbuf has a refcount of 1 now that we have released our initial reference */

  /* we don't want an icon in that row any longer */
  gtk_list_store_set(list_store, &#38;iter, 0, NULL, -1);

  /* pixbuf has automatically been destroyed after its refcount has reached 0.
   *  The list store called g_object_unref() on the pixbuf when it replaced
   *  the object in the store with a new value (NULL). */
</PRE
></TD
></TR
></TABLE
><P
>&#13;Having learned how to add, manipulate, and retrieve data from a store, the next step is to get that data
displayed in a <TT
CLASS="literal"
>GtkTreeView</TT
> widget.
</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="95%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sec-treemodel-remove-many-rows.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="treeview-tutorial.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sec-treemodel-storing-structs.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Removing Multiple Rows</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sec-treemodels.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Storing Data Structures: of Pointers, GBoxed Types, and GObject (TODO)</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>