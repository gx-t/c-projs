<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>GtkCellRendererText, UTF8, and pango markup</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GTK+ 2.0 Tree View Tutorial"
HREF="treeview-tutorial.html"><LINK
REL="UP"
TITLE="Mapping Data to the Screen: GtkTreeViewColumn and GtkCellRenderer"
HREF="sec-treeviewcol-renderer.html"><LINK
REL="PREVIOUS"
TITLE="GtkCellRendererText and Integer, Boolean and Float Types"
HREF="sec-treeview-celltext-types.html"><LINK
REL="NEXT"
TITLE="A Working Example"
HREF="sec-treeview-col-example.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="./treeview-tutorial.css"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GTK+ 2.0 Tree View Tutorial</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sec-treeview-celltext-types.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 5. Mapping Data to the Screen: GtkTreeViewColumn and GtkCellRenderer</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sec-treeview-col-example.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="95%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="sec-treeview-col-utf8-pango"
>5.5. GtkCellRendererText, UTF8, and pango markup</A
></H1
><P
>&#13;All text used in Gtk+-2.0 widgets needs to be in UTF8 encoding, and
<TT
CLASS="literal"
>GtkCellRendererText</TT
> is no exception. Text in plain
ASCII is automatically valid UTF8, but as soon as you have special
characters that do not exist in plain ASCII (usually characters that
are not used in the English language alphabet), they need to be in
UTF8 encoding. There are many different character encodings that all
specify different ways to tell the computer which character is meant.
Gtk+-2.0 uses UTF8, and whenever you have text that is in a different
encoding, you need to convert it to UTF8 encoding first, using one of the GLib
<A
HREF="http://developer.gnome.org/doc/API/2.0/glib/glib-Character-Set-Conversion.html"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>g_convert</TT
></A
> family of functions. If you only
use text input from other Gtk+ widgets, you are on the safe side, as
they will return all text in UTF8 as well.
</P
><P
>&#13;However, if you use 'external' sources of text input, then you
must convert that text from the text's encoding (or the user's locale) to UTF8,
or it will not be rendered correctly (either not at all, or it will be cut off
after the first invalid character). Filenames are especially hard, because there
is no indication whatsoever what character encoding a filename is in (it might
have been created when the user was using a different locale, so filename encoding
is basically unreliable and broken). You may want to convert to UTF8 with fallback
characters in that case. You can check whether a string is valid UTF8 with
<A
HREF="http://developer.gnome.org/doc/API/2.0/glib/glib-Unicode-Manipulation.html#g-utf8-validate"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>g_utf8_validate</TT
></A
>. You should, in this author's opinion
at least, put these checks into your code at crucial places wherever it is
not affecting performance, especially if you are an English-speaking programmer
that has little experience with non-English locales. It will make it easier for
others and yourself to spot problems with non-English locales later on.
</P
><P
>&#13;In addition to the "text" property, GtkCellRendererText also has a "markup"
property that takes text with <A
HREF="http://developer.gnome.org/doc/API/2.0/pango/PangoMarkupFormat.html"
TARGET="_top"
>&#13;pango markup</A
> as input. Pango markup allows you to place special
tags into a text string that affect the style the text is rendered (see the pango
documentation). Basically you can achieve everything you can achieve with the other
properties also with pango markup (only that using properties is more efficient and
less messy). Pango markup has one distinct advantage though that you cannot achieve
with text cell renderer properties: with pango markup, you can change the text style
in the middle of the text, so you could, for example, render one part of a text string
in bold print, and the rest of the text in normal. Here is an example of a string with
pango markup:
</P
><P
><TT
CLASS="literal"
>&#13;"You can have text in &#60;b&#62;bold&#60;/b&#62; or in a &#60;span color='Orange'&#62;different color&#60;/span&#62;"
</TT
></P
><P
>&#13;When using the <TT
CLASS="literal"
>"markup"</TT
> property, you need to take into account
that the <TT
CLASS="literal"
>"markup"</TT
> and <TT
CLASS="literal"
>"text"</TT
> properties do
not seem to be mutually exclusive (I suppose this could be called a bug).
In other words: whenever you set <TT
CLASS="literal"
>"markup"</TT
> (and have used the
<TT
CLASS="literal"
>"text"</TT
> property before), set the <TT
CLASS="literal"
>"text"</TT
>
property to NULL, and vice versa. Example:
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  ...

  void
  foo_cell_data_function ( ... )
  {
    ...
    if (foo-&#62;is_important)
      g_object_set(renderer, "markup", "&#60;b&#62;important&#60;/b&#62;", "text", NULL, NULL);
    else
      g_object_set(renderer, "markup", NULL, "text", "not important", NULL);
    ...
  }

  ...
</PRE
></TD
></TR
></TABLE
><P
>&#13;Another thing to keep in mind when using pango markup text is that you might need to escape
text if you construct strings with pango markup on the fly using random input data. For example:
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;  ...

  void
  foo_cell_data_function ( ... )
  {
    gchar *markuptxt;

    ...
    /* This might be problematic if artist_string or title_string
     *   contain markup characters/entities: */
    markuptxt = g_strdup_printf("&#60;b&#62;%s&#60;/b&#62; - &#60;i&#62;%s&#60;/i&#62;",
                                artist_string, title_string);
    ...
    g_object_set(renderer, "markup", markuptxt, "text", NULL, NULL);
    ...
    g_free(markuptxt);
  }

  ...
</PRE
></TD
></TR
></TABLE
><P
>&#13;The above example will not work if artist_string is "Simon &#38; Garfunkel" for example, because the &#38;
character is one of the characters that is special. They need to be escaped, so that pango knows that they
do not refer to any pango markup, but are just characters. In this case the string would need to be
"Simon &#38;amp; Garfunkel" in order to make sense in between the pango markup in which it is going to be
pasted. You can escape a string with <A
HREF="http://developer.gnome.org/doc/API/2.0/glib/glib-Simple-XML-Subset-Parser.html#g-markup-escape-text"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>g_markup_escape</TT
></A
> (and you will need to free the
resulting newly-allocated string again with <TT
CLASS="literal"
>g_free</TT
>).
</P
><P
>&#13;It is possible to combine both pango markup and text cell renderer properties. Both will be 'added' together
to render the string in question, only that the text cell renderer properties will be applied to the whole
string. If you set the <TT
CLASS="literal"
>"markup"</TT
> property to normal text without any pango markup,
it will render as normal text just as if you had used the <TT
CLASS="literal"
>"text"</TT
> property. However,
as opposed to the <TT
CLASS="literal"
>"text"</TT
> property, special characters in the <TT
CLASS="literal"
>"markup"</TT
>
property text would still need to be escaped, even if you do not use pango markup in the text.
</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="95%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sec-treeview-celltext-types.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="treeview-tutorial.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sec-treeview-col-example.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>GtkCellRendererText and Integer, Boolean and Float Types</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sec-treeviewcol-renderer.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>A Working Example</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>