<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Getting the Cell Renderer a Click Event Happened On</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GTK+ 2.0 Tree View Tutorial"
HREF="treeview-tutorial.html"><LINK
REL="UP"
TITLE="Miscellaneous"
HREF="sec-misc.html"><LINK
REL="PREVIOUS"
TITLE="Column Expander Visibility"
HREF="sec-misc-expander-visibility.html"><LINK
REL="NEXT"
TITLE="Glade and Tree Views"
HREF="sec-misc-glade.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="./treeview-tutorial.css"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GTK+ 2.0 Tree View Tutorial</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sec-misc-expander-visibility.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 9. Miscellaneous</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sec-misc-glade.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="95%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="sec-misc-get-renderer-from-click"
>9.3. Getting the Cell Renderer a Click Event Happened On</A
></H1
><P
>&#13;It seems that in many cases when people want to know the cell
renderer a click event happened on, they do not really need to
know the cell renderer, but rather want to modify an individual
cell in a particular column. For this you do not need to know
the cell renderer. Use <TT
CLASS="literal"
>&#13;<A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkTreeView.html#gtk-tree-view-get-path-at-pos"
TARGET="_top"
>&#13;gtk_tree_view_get_path_at_pos</A
></TT
> to get a tree
path from the x and y coordinates of the button event that is
passed to you in a <TT
CLASS="literal"
>"button-press-event"</TT
> signal
callback (if you use the <TT
CLASS="literal"
>"row-activated"</TT
> signal
to catch double-clicks you get the tree path passed directly into
the callback function). Then convert that tree path into an iter
using <TT
CLASS="literal"
><A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkTreeModel.html#gtk-tree-model-get-iter"
TARGET="_top"
>&#13;gtk_tree_model_get_iter</A
></TT
> and modify the data in
the cell you want to modify with <TT
CLASS="literal"
>gtk_list_store_set</TT
>
or <TT
CLASS="literal"
>gtk_tree_store_set</TT
>.
</P
><P
>&#13;If you really do need to know the cell renderer where a button press
event happened, that is a bit more tricky. Here is a suggestion on
how to approach this issue (the function has not been well-tested and
might not work correctly if the content rendered by one renderer in
different columns varies in width; please send suggestions on how
to fix or improve this function to the author):
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;static gboolean
tree_view_get_cell_from_pos(GtkTreeView *view, guint x, guint y, GtkCellRenderer **cell)
{
	GtkTreeViewColumn *col = NULL;
	GList             *node, *columns, *cells;
	guint              colx = 0;

	g_return_val_if_fail ( view != NULL, FALSE );
	g_return_val_if_fail ( cell != NULL, FALSE );

	/* (1) find column and column x relative to tree view coordinates */

	columns = gtk_tree_view_get_columns(view);

	for (node = columns;  node != NULL &#38;&#38; col == NULL;  node = node-&#62;next)
	{
		GtkTreeViewColumn *checkcol = (GtkTreeViewColumn*) node-&#62;data;

		if (x &#62;= colx  &#38;&#38;  x &#60; (colx + checkcol-&#62;width))
			col = checkcol;
		else
			colx += checkcol-&#62;width;
	}

	g_list_free(columns);

	if (col == NULL)
		return FALSE; /* not found */

	/* (2) find the cell renderer within the column */

	cells = gtk_tree_view_column_get_cell_renderers(col);

	for (node = cells;  node != NULL;  node = node-&#62;next)
	{
		GtkCellRenderer *checkcell = (GtkCellRenderer*) node-&#62;data;
		guint            width = 0, height = 0;

		/* Will this work for all packing modes? doesn't that
		 *  return a random width depending on the last content
		 * rendered? */
		gtk_cell_renderer_get_size(checkcell, GTK_WIDGET(view), NULL, NULL, NULL, &#38;width, NULL);

		if (x &#62;= colx &#38;&#38; x &#60; (colx + width))
		{
			*cell = checkcell;
			g_list_free(cells);
			return TRUE;
		}

		colx += width;
	}

	g_list_free(cells);
	return FALSE; /* not found */
}

static gboolean
onButtonPress (GtkWidget *view, GdkEventButton *bevent, gpointer data)
{
	GtkCellRenderer *renderer = NULL;

	if (tree_view_get_cell_from_pos(GTK_TREE_VIEW(view), bevent-&#62;x, bevent-&#62;y, &#38;renderer))
		g_print ("Renderer found\n");
	else
		g_print ("Renderer not found!\n");
}

</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="95%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sec-misc-expander-visibility.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="treeview-tutorial.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sec-misc-glade.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Column Expander Visibility</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sec-misc.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Glade and Tree Views</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>