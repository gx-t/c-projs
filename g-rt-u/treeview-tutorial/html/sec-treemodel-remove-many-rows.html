<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Removing Multiple Rows</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="GTK+ 2.0 Tree View Tutorial"
HREF="treeview-tutorial.html"><LINK
REL="UP"
TITLE="GtkTreeModels for Data Storage: GtkListStore and GtkTreeStore"
HREF="sec-treemodels.html"><LINK
REL="PREVIOUS"
TITLE="Removing Rows"
HREF="sec-treemodel-remove-row.html"><LINK
REL="NEXT"
TITLE="Storing GObjects (Pixbufs etc.)"
HREF="sec-treemodel-storing-gobjects.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="./treeview-tutorial.css"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>GTK+ 2.0 Tree View Tutorial</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sec-treemodel-remove-row.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 3. GtkTreeModels for Data Storage: GtkListStore and GtkTreeStore</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sec-treemodel-storing-gobjects.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="95%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="sec-treemodel-remove-many-rows"
>3.7. Removing Multiple Rows</A
></H1
><P
>&#13;Removing multiple rows at once can be a bit tricky at times, and requires some thought on how to do this best. For
example, it is not possible to traverse a store with <TT
CLASS="literal"
>gtk_tree_model_foreach</TT
>, check in the callback
function whether the given row should be removed and then just remove it by calling one of the stores' remove functions.
This will not work, because the model is changed from within the foreach loop, which might suddenly invalidate formerly
valid tree iters in the foreach function, and thus lead to unpredictable results.
</P
><P
>&#13;You could traverse the store in a <TT
CLASS="literal"
>while</TT
> loop of course, and call
<TT
CLASS="literal"
>gtk_list_store_remove</TT
> or <TT
CLASS="literal"
>gtk_tree_store_remove</TT
>
whenever you want to remove a row, and then just continue if the remove functions
returns <TT
CLASS="literal"
>TRUE</TT
> (meaning that the iter is still valid and now points
to the row after the row that was removed). However, this approach will only work
with Gtk+-2.2 or later and will not work if you want your programs to compile
and work with Gtk+-2.0 as well, for the reasons outlined above (in Gtk+-2.0 the
remove functions did not set the passed iter to the next valid row). Also, while
this approach might be feasable for a list store, it gets a bit awkward for a
tree store.
</P
><P
>&#13;Here is an example for an alternative approach to removing multiple rows
in one go (here we want to remove all rows from the store that contain
persons that have been born after 1980, but it could just as well be
all selected rows or some other criterion):
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;
 /******************************************************************
  *
  *  Removing multiple rows in one go
  *
  ******************************************************************/

  ...

  gboolean
  foreach_func (GtkTreeModel *model,
                GtkTreePath  *path,
                GtkTreeIter  *iter,
                GList       **rowref_list)
  {
    guint  year_of_birth;

    g_assert ( rowref_list != NULL );

    gtk_tree_model_get (model, iter, COL_YEAR_BORN, &#38;year_of_birth, -1);

    if ( year_of_birth &#62; 1980 )
    {
      GtkTreeRowReference  *rowref;

      rowref = gtk_tree_row_reference_new(model, path);

      *rowref_list = g_list_append(*rowref_list, rowref);
    }

    return FALSE; /* do not stop walking the store, call us with next row */
  }

  void
  remove_people_born_after_1980 (void)
  {
     GList *rr_list = NULL;    /* list of GtkTreeRowReferences to remove */
     GList *node;

     gtk_tree_model_foreach(GTK_TREE_MODEL(store),
                            (GtkTreeModelForeachFunc) foreach_func,
                            &#38;rr_list);

     for ( node = rr_list;  node != NULL;  node = node-&#62;next )
     {
        GtkTreePath *path;

        path = gtk_tree_row_reference_get_path((GtkTreeRowReference*)node-&#62;data);

        if (path)
        {
           GtkTreeIter  iter;

           if (gtk_tree_model_get_iter(GTK_TREE_MODEL(store), &#38;iter, path))
           {
             gtk_list_store_remove(store, &#38;iter);
           }

           /* FIXME/CHECK: Do we need to free the path here? */
        }
     }

     g_list_foreach(rr_list, (GFunc) gtk_tree_row_reference_free, NULL);
     g_list_free(rr_list);
  }

  ...

</PRE
></TD
></TR
></TABLE
><P
>&#13;<A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkListStore.html#gtk-list-store-clear"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_list_store_clear</TT
></A
> and <A
HREF="http://developer.gnome.org/doc/API/2.0/gtk/GtkTreeStore.html#gtk-tree-store-clear"
TARGET="_top"
>&#13;<TT
CLASS="literal"
>gtk_tree_store_clear</TT
></A
> come in handy if you want to remove all rows.
</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="95%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sec-treemodel-remove-row.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="treeview-tutorial.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sec-treemodel-storing-gobjects.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Removing Rows</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sec-treemodels.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Storing GObjects (Pixbufs etc.)</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>